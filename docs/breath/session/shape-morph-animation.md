Полное описание системы морфинга дыхательных фигур
Базовая геометрия и координаты
Все фигуры вписаны в единый bounding box размером fullWidth × fullHeight с центром в точке center. Для простоты можно считать это квадратом 100×100 с центром в (50, 50).

Квадрат занимает весь bounding box. Его четыре угла находятся в координатах: левый верхний (0, 0), правый верхний (100, 0), правый нижний (100, 100), левый нижний (0, 100).

Треугольник вверх имеет вершину строго по центру верхней стороны в точке (50, 0) и два угла основания в точках (0, 100) и (100, 100).

Треугольник вниз имеет вершину строго по центру нижней стороны в точке (50, 100) и два угла основания в точках (0, 0) и (100, 0).

Круг вписан в тот же bounding box с центром в (50, 50) и радиусом 50, касаясь всех четырёх сторон квадрата в их серединах.

Начальная точка змейки для каждой фигуры
Змейка представляет собой 120 точек, равномерно распределённых по периметру фигуры. Точка с индексом 0 называется головой змейки и для каждой фигуры должна находиться в строго определённом месте.

Для квадрата голова змейки находится в левом нижнем углу в точке (0, 100).

Для треугольника вверх голова змейки находится в левом нижнем углу треугольника в точке (0, 100).

Для треугольника вниз голова змейки находится в вершине треугольника в точке (50, 100).

Для круга голова змейки находится в самой нижней точке окружности в точке (50, 100).

Морфинг квадрат → треугольник вверх
В начальном состоянии при t=0 форма является квадратом. Верхняя сторона квадрата имеет полную ширину от (0, 0) до (100, 0). Нижняя сторона тоже имеет полную ширину от (0, 100) до (100, 100). Боковые стороны вертикальные.

По мере увеличения параметра t верхняя сторона начинает сужаться к центру. Левая верхняя точка движется строго горизонтально вправо от (0, 0) к (50, 0). Правая верхняя точка движется строго горизонтально влево от (100, 0) к (50, 0). Координата y этих точек всегда остаётся равной 0.

Нижняя сторона не меняется и остаётся горизонтальной линией от (0, 100) до (100, 100).

Боковые стороны при этом наклоняются. Левая сторона соединяет текущую левую верхнюю точку с левой нижней точкой (0, 100). Правая сторона соединяет текущую правую верхнюю точку с правой нижней точкой (100, 100).

В каждый момент времени промежуточная форма является трапецией с горизонтальными верхом и низом.

При t=1 левая и правая верхние точки совпадают в центре в точке (50, 0), образуя вершину треугольника. Форма становится треугольником вверх.

Голова змейки всегда остаётся в нижнем левом углу, в точке (0, 100), независимо от значения t.

Морфинг квадрат → треугольник вниз
Принцип аналогичен предыдущему, но симметричен по вертикали.

При t=0 форма является квадратом. Нижняя сторона имеет полную ширину от (0, 100) до (100, 100). Верхняя сторона имеет полную ширину от (0, 0) до (100, 0).

По мере увеличения t нижняя сторона сужается к центру. Левая нижняя точка движется горизонтально вправо от (0, 100) к (50, 100). Правая нижняя точка движется горизонтально влево от (100, 100) к (50, 100). Координата y всегда равна 100.

Верхняя сторона не меняется и остаётся от (0, 0) до (100, 0).

При t=1 нижние точки совпадают в центре в точке (50, 100), образуя вершину треугольника вниз.

Голова змейки перемещается из левого нижнего угла квадрата в нижнюю вершину треугольника. При t=0 это точка (0, 100) нижний левый угол квадрата. При t=1 это точка (50, 100), которая теперь является вершиной треугольника.

Морфинг треугольник вверх → треугольник вниз
При t=0 форма является треугольником вверх с вершиной в (50, 0) и основанием от (0, 100) до (100, 100).

По мере увеличения t происходят два одновременных процесса. Верхняя вершина раздвигается в горизонтальную линию. Точка (50, 0) расщепляется на две точки, которые движутся горизонтально в противоположных направлениях к (0, 0) и (100, 0). Одновременно нижнее основание сужается к центру. Точки (0, 100) и (100, 100) движутся горизонтально навстречу друг другу к центральной точке (50, 100).

При t=0.5 форма представляет собой прямоугольник. Верхняя сторона идёт от (25, 0) до (75, 0). Нижняя сторона идёт от (25, 100) до (75, 100). Это не случайность, а естественная промежуточная фаза.

При t=1 верхняя сторона достигает полной ширины от (0, 0) до (100, 0), а нижние точки сходятся в вершину в точке (50, 100). Форма становится треугольником вниз.

Голова змейки начинается в левом нижнем углу треугольника в точке (0, 100). По мере морфинга она должна переместиться в вершину треугольника в точку (50, 100). Это требует фазового сдвига змейки вдоль периметра на 1/6 длины пути. Тк три стороны треугольника и конечная точка окажется в центре бывшего нижнего основания треугольника. Если считать, что голова движется по стороне квадрата , она пройдет 1/2 стороны или 1/8 всей длины квадрата.

Морфинг круг → квадрат
При t=0 форма является кругом с центром в (50, 50) и радиусом 50.

По мере увеличения t радиус скругления углов квадрата уменьшается. Форма остаётся вписанной в тот же bounding box, но её углы постепенно заостряются.

При t=1 радиус скругления становится равным нулю, и форма превращается в квадрат с острыми углами в точках (0, 0), (100, 0), (100, 100), (0, 100).

Голова змейки перемещается по нижней стороне квадрата к левому нижнему углу из точки (50, 100) в точку (0, 100).

Морфинг круг → треугольник вверх
Это самый сложный случай. При t=0 форма является кругом. При t=1 форма является треугольником вверх с вершиной в (50, 0) и основанием от (0, 100) до (100, 100).

Ключевая особенность: вершина треугольника (50, 0) лежит на окружности, и центральная точка основания (50, 100) находится на окружности, так как круг вписан в квадрат.

В процессе морфинга боковые стороны треугольника должны плавно трансформироваться. При t=0 это дуги окружности. При t=1 это прямые линии. Промежуточные формы представляют собой треугольник с изогнутыми сторонами, где степень изогнутости уменьшается по мере роста t.

Верхняя вершина треугольника остаётся на месте в точке (50, 0) на протяжении всего морфинга. Два угла основания должны сжаться, став двумя нижними четвертями круга.

В результате получится круг, вписанный в квадрат с точками касания: низ - (50, 100), лево - (0, 50), верх - (50, 0), право - (100, 50)

Голова змейки находится на круге в точке (50, 100) при t=0 и должна оказаться в левом углу треугольника (0, 100) при t=1. Основание треугольника представляет собой горизонтальную линию от (0, 100) до (100, 100), и точка (0, 100) находится в ее начале слева.

Морфинг круг → треугольник вниз
Принцип аналогичен предыдущему, но симметричен по вертикали.

При t=0 форма является кругом. При t=1 форма является треугольником вниз с вершиной в (50, 100) и основанием от (0, 0) до (100, 0).

Нижняя вершина остаётся на месте в точке (50, 100). Два угла основания вытягиваются из верхних четвертей круга в точки (0, 0) и (100, 0). Изменяется кривизна рёбер от дуг к прямым линиям.

Голова змейки при t=0 находится в точке (50, 100) на круге. При t=1 она должна оказаться в вершине треугольника в той же точке (50, 100). Фазовый сдвиг отсутствует.

Механизм змейки и перераспределения точек
В каждый кадр анимации вычисляется промежуточный геометрический Path в зависимости от текущего значения t. Этот Path измеряется, определяется его полная длина. Затем вдоль этой длины равномерно распределяются 120 точек змейки.

Точка с индексом 0 размещается на расстоянии 0 от начала пути. Точка с индексом 1 на расстоянии длина/120 от начала пути. Точка с индексом i на расстоянии i×длина/120 от начала пути.

Если требуется фазовый сдвиг, к каждому расстоянию добавляется смещение, пропорциональное полной длине пути и величине сдвига. Смещение вычисляется как сдвиг×длина, где сдвиг является числом от 0 до 1. Это эквивалентно прокрутке всех точек вдоль периметра.

Начало Path для каждой фигуры определяется так, чтобы точка с нулевым расстоянием совпадала с головой змейки. Для квадрата Path начинается с точки (0, 100). Для треугольника вверх Path начинается с точки (0, 1000). Для треугольника вниз Path начинается с точки (50, 100). Для круга Path начинается с точки (50, 100).

Фазовый сдвиг для выравнивания головы змейки
Перед началом морфинга вычисляется необходимый фазовый сдвиг. Берутся финальные геометрические пути начальной и целевой фигур. На пути целевой фигуры берётся точка с нулевым расстоянием, то есть голова змейки целевой фигуры. На пути начальной фигуры ищется ближайшая к ней точка. Её относительное положение вдоль длины пути начальной фигуры и определяет необходимый сдвиг.

Если голова целевой фигуры совпадает с головой начальной фигуры или очень близка к ней, сдвиг близок к нулю. Если голова целевой фигуры находится на противоположной стороне периметра, сдвиг близок к 0.5.

В процессе анимации текущий фазовый сдвиг линейно растёт от 0 до вычисленного значения пропорционально параметру t. При t=0 сдвига нет, и точки распределены вдоль начальной фигуры без смещения. При t=1 сдвиг полный, и точки распределены вдоль конечной фигуры так, что голова змейки оказывается в правильном месте.

Построение промежуточного геометрического каркаса
Для морфингов квадрат-треугольник и треугольник-треугольник каркас строится как трапеция с четырьмя точками. Эти четыре точки всегда образуют замкнутый четырёхугольник, даже если две из них совпадают.

Для морфинга круг-квадрат каркас строится как скруглённый прямоугольник через RRect с радиусом скругления, интерполированным от половины размера до нуля.

Для морфинга круг-треугольник каркас строится следующим образом. При t=1 имеем треугольник с тремя вершинами: для треугольника вверх это (50, 0), (0, 100) и (100, 100). При t=0 нужно получить круг с центром (50, 50) и радиусом 50.

Морфинг работает так: верхняя вершина (50, 0) остаётся неподвижной на протяжении всей анимации. Два угла основания должны «втянуться» внутрь. При t=1 левый угол находится в точке (0, 100). По мере уменьшения t (движения к кругу) этот угол движется по дуге к точке (0, 50) — левой точке касания круга. Аналогично правый угол движется из (100, 100) к (100, 50).

Траектории движения углов — это дуги окружности радиуса 50 с центром в (50, 50). Левый угол движется по дуге от (0, 100) через промежуточные точки к (0, 50). Правый угол движется от (100, 100) к (100, 50).

Стороны треугольника при этом искривляются. Левая сторона при t=1 идёт прямо от (50, 0) к (0, 100). При t=0 она должна превратиться в дугу окружности от (50, 0) через (0, 50) к (50, 100). Правая сторона аналогично превращается из прямой линии в дугу от (50, 0) через (100, 50) к (50, 100).

Нижняя сторона (основание) при t=1 является прямой линией от (0, 100) до (100, 100). При t=0 она должна стать дугой окружности от (0, 50) через (50, 100) до (100, 50).

Каждая из трёх сторон интерполируется независимо через квадратичную кривую Безье с тремя точками: две конечные точки ребра и одна контрольная точка посередине. При t=0 контрольная точка максимально отклонена от прямой линии, создавая дугу круга. При t=1 контрольная точка лежит на прямой между конечными точками, вырождая кривую в прямую линию.

Ключевой принцип
Круг и треугольник используют одинаковую топологию — 4 опорные точки (endpoints), соединённые дугами/линиями.
Координаты опорных точек
Круг (t=0):

Верх: (50, 0)
Лево: (0, 50)
Низ: (50, 100)
Право: (100, 50)

Треугольник вверх (t=1):

Верх: (50, 0) — неподвижна
Лево: (0, 100) — движется вертикально вниз
Низ: (50, 100) — неподвижна
Право: (100, 100) — движется вертикально вниз

Треугольник вниз (t=1):

Верх: (50, 0) — неподвижна
Лево: (0, 0) — движется вертикально вверх
Низ: (50, 100) — неподвижна
Право: (100, 0) — движется вертикально вверх

Механизм морфинга

Боковые точки скользят по вертикальным сторонам квадрата
Верх и низ всегда неподвижны (лежат на окружности И являются вершинами треугольников)
Кривизна рёбер интерполируется от дуги окружности (t=0) к прямой линии (t=1)
Path состоит из 4 сегментов, каждый endpoint гарантированно лежит на контуре

Результат
При t=0 получается правильный круг с точками касания. При t=1 — треугольник с прямыми сторонами. Промежуточные формы — четырёхугольник с изогнутыми сторонами.